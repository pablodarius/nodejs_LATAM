/**
 * mock-xmlhttprequest v5.1.0
 * (c) 2019 Bertrand Guay-Paquet
 * @license ISC
 */
!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t((e=e||self).MockXMLHttpRequest={})}(this,function(e){"use strict";var t=function(e,t,s){this.type=e,this.loaded=void 0!==t?t:0,s>0?(this.total=s,this.lengthComputable=!0):(this.total=0,this.lengthComputable=!1)};function s(e){return"boolean"==typeof e?e:!!e.capture}var r=function(e){void 0===e&&(e=this),this._eventContext=e,this._eventListeners={}};r.prototype.hasListeners=function(){var e=this;return r.events.some(function(t){return e._eventListeners[t]||e["on"+t]})},r.prototype.addEventListener=function(e,t,r){if(void 0===r&&(r=!1),t){var o={callback:t,useCapture:s(r),once:!!r.once};this._eventListeners[e]=this._eventListeners[e]||[],this._eventListeners[e].some(function(e){return e.callback===o.callback&&e.useCapture===o.useCapture})||this._eventListeners[e].push(o)}},r.prototype.removeEventListener=function(e,t,r){if(void 0===r&&(r=!1),this._eventListeners[e]){var o=s(r),n=this._eventListeners[e].findIndex(function(e){return t===e.callback&&o===e.useCapture});n>=0&&this._eventListeners[e].splice(n,1)}},r.prototype.dispatchEvent=function(e){var t=this,s=[];if(this._eventListeners[e.type]&&(s.push.apply(s,this._eventListeners[e.type].map(function(e){return e.callback})),this._eventListeners[e.type]=this._eventListeners[e.type].filter(function(e){return!e.once})),r.events.includes(e.type)){var o=this["on"+e.type];o&&s.push(o)}return s.forEach(function(s){"function"==typeof s?s.call(t._eventContext,e):s.handleEvent()}),!0},r.events=["loadstart","progress","abort","error","load","timeout","loadend"];var o=function(e){var t=this;this._headers=new Map,e&&e instanceof Object&&Object.keys(e).forEach(function(s){t.addHeader(s,e[s])})};o.prototype.reset=function(){this._headers.clear()},o.prototype.getHeader=function(e){var t=this._headers.get(e.toLowerCase());return void 0!==t?t:null},o.prototype.getAll=function(){var e=this;return[].concat(this._headers.keys()).sort().reduce(function(t,s){return""+t+s+": "+e._headers.get(s)+"\r\n"},"")},o.prototype.getHash=function(){var e={};return this._headers.forEach(function(t,s){e[s]=t}),e},o.prototype.addHeader=function(e,t){e=e.toLowerCase();var s=this._headers.get(e);s&&(t=s+", "+t),this._headers.set(e,t)};var n=new RegExp("^("+["Accept-Charset","Accept-Encoding","Access-Control-Request-Headers","Access-Control-Request-Method","Connection","Content-Length","Cookie","Cookie2","Date","DNT","Expect","Host","Keep-Alive","Origin","Referer","TE","Trailer","Transfer-Encoding","Upgrade","Via"].join("|")+"|Proxy-.*|Sec-.*)$","i");var i=new RegExp("^("+["DELETE","GET","HEAD","OPTIONS","POST","PUT"].join("|")+")$","i");function a(e){return i.test(e)&&(e=e.toUpperCase()),e}var u={100:"Continue",101:"Switching Protocols",200:"OK",201:"Created",202:"Accepted",203:"Non-Authoritative Information",204:"No Content",205:"Reset Content",206:"Partial Content",207:"Multi-Status",208:"Already Reported",300:"Multiple Choices",301:"Moved Permanently",302:"Found",303:"See Other",304:"Not Modified",305:"Use Proxy",307:"Temporary Redirect",308:"Permanent Redirect",400:"Bad Request",401:"Unauthorized",402:"Payment Required",403:"Forbidden",404:"Not Found",405:"Method Not Allowed",406:"Not Acceptable",407:"Proxy Authentication Required",408:"Request Timeout",409:"Conflict",410:"Gone",411:"Length Required",412:"Precondition Failed",413:"Payload Too Large",414:"URI Too Long",415:"Unsupported Media Type",416:"Range Not Satisfiable",417:"Expectation Failed",422:"Unprocessable Entity",423:"Locked",424:"Failed Dependency",426:"Upgrade Required",428:"Precondition Required",429:"Too Many Requests",431:"Request Header Fields Too Large",500:"Internal Server Error",501:"Not Implemented",502:"Bad Gateway",503:"Service Unavailable",504:"Gateway Timeout",505:"HTTP Version Not Supported",507:"Insufficient Storage",511:"Network Authentication Required"};function d(e,t){void 0===t&&(t="");var s=new Error(t);throw s.name=e,s}var h=function(e){function s(){e.call(this),this._readyState=s.UNSENT,this.requestHeaders=new o,this._withCredentials=!1,this._timeout=0,this._upload=new e(this),this._response=this._networkErrorResponse(),this.timeoutEnabled=!0,"function"==typeof s.onCreate&&s.onCreate(this)}e&&(s.__proto__=e),s.prototype=Object.create(e&&e.prototype),s.prototype.constructor=s;var r={readyState:{configurable:!0},timeout:{configurable:!0},withCredentials:{configurable:!0},upload:{configurable:!0},status:{configurable:!0},statusText:{configurable:!0},responseType:{configurable:!0},response:{configurable:!0},responseText:{configurable:!0},responseXML:{configurable:!0}};return r.readyState.get=function(){return this._readyState},r.readyState.set=function(e){return e},s.prototype.open=function(e,t,r){if(void 0===r&&(r=!0),!r)throw new Error("async = false is not supported.");(function(e){return/^(CONNECT|TRACE|TRACK)$/i.test(e)})(e)&&d("SecurityError",'Method "'+e+'" forbidden.'),e=a(e),this._terminateRequest(),this._sendFlag=!1,this._uploadListenerFlag=!1,this.method=e,this.url=t,this.requestHeaders.reset(),this._response=this._networkErrorResponse(),this._readyState!==s.OPENED&&(this._readyState=s.OPENED,this._fireReadyStateChange())},s.prototype.setRequestHeader=function(e,t){if((this._readyState!==s.OPENED||this._sendFlag)&&d("InvalidStateError"),"string"!=typeof e||"string"!=typeof t)throw new SyntaxError;(function(e){return n.test(e)})(e)||(t=t.trim(),this.requestHeaders.addHeader(e,t))},r.timeout.get=function(){return this._timeout},r.timeout.set=function(e){this._timeout=e,this._sendFlag&&this.timeoutEnabled&&this.constructor.timeoutEnabled&&this._scheduleRequestTimeout()},r.withCredentials.get=function(){return this._withCredentials},r.withCredentials.set=function(e){(this._readyState!==s.UNSENT&&this._readyState!==s.OPENED||this._sendFlag)&&d("InvalidStateError"),this._withCredentials=!!e},r.upload.get=function(){return this._upload},r.upload.set=function(e){return e},s.prototype.send=function(e){var t=this;if(void 0===e&&(e=null),(this._readyState!==s.OPENED||this._sendFlag)&&d("InvalidStateError"),"GET"!==this.method&&"HEAD"!==this.method||(e=null),null!==e){var r,o=null;"string"==typeof e?o="text/plain;charset=UTF-8":e.type&&(o=e.type),r=o,null===this.requestHeaders.getHeader("Content-Type")&&null!==r&&this.requestHeaders.addHeader("Content-Type",r)}if(this._uploadListenerFlag=this._upload.hasListeners(),this.body=e,this._uploadCompleteFlag=null===this.body,this._timedOutFlag=!1,this._sendFlag=!0,this._fireEvent("loadstart",0,0),!this._uploadCompleteFlag&&this._uploadListenerFlag&&this._fireUploadEvent("loadstart",0,this._getRequestBodySize()),this._readyState===s.OPENED&&this._sendFlag){if(this._timeoutReference=Date.now(),this._scheduleRequestTimeout(),"function"==typeof this.onSend){var n=this.onSend;setTimeout(function(){return n.call(t,t)},0)}if("function"==typeof s.onSend){var i=s.onSend;setTimeout(function(){return i.call(t,t)},0)}}},s.prototype.abort=function(){this._terminateRequest(),(this._readyState===s.OPENED&&this._sendFlag||this._readyState===s.HEADERS_RECEIVED||this._readyState===s.LOADING)&&this._requestErrorSteps("abort"),this._readyState===s.DONE&&(this._readyState=s.UNSENT,this._response=this._networkErrorResponse())},r.status.get=function(){return this._response.status},r.status.set=function(e){return e},r.statusText.get=function(){return this._response.statusMessage},r.statusText.set=function(e){return e},s.prototype.getResponseHeader=function(e){return this._response.headers.getHeader(e)},s.prototype.getAllResponseHeaders=function(){return this._response.headers.getAll()},s.prototype.overrideMimeType=function(){this._readyState!==s.LOADING&&this._readyState!==s.DONE||d("InvalidStateError")},r.responseType.get=function(){return this._responseType||""},r.responseType.set=function(e){this._readyState!==s.LOADING&&this._readyState!==s.DONE||d("InvalidStateError");["","arraybuffer","blob","document","json","text"].includes(e)&&(this._responseType=e)},r.response.get=function(){if(""===this.responseType||"text"===this.responseType)return this._readyState!==s.LOADING&&this._readyState!==s.DONE?"":null===this._response.body?"":this._response.body;if(this._readyState!==s.DONE)return null;if("json"===this.responseType){if(null===this._response.body)return null;try{return JSON.parse(this._response.body)}catch(e){return null}}return this._response.body},r.response.set=function(e){return e},r.responseText.get=function(){return""!==this.responseType&&"text"!==this.responseType&&d("InvalidStateError"),this._readyState!==s.LOADING&&this._readyState!==s.DONE?"":null===this._response.body?"":this._response.body},r.responseText.set=function(e){return e},r.responseXML.get=function(){return""!==this.responseType&&"document"!==this.responseType&&d("InvalidStateError"),this._readyState!==s.DONE?null:null===this._response.body?"":this._response.body},r.responseXML.set=function(e){return e},s.prototype.uploadProgress=function(e){if(!this._sendFlag||this._uploadCompleteFlag)throw new Error("Mock usage error detected.");this._uploadListenerFlag&&this._fireUploadEvent("progress",e,this._getRequestBodySize())},s.prototype.respond=function(e,t,s,r){this.setResponseHeaders(e,t,r),this.setResponseBody(s)},s.prototype.setResponseHeaders=function(e,t,r){if(this._readyState!==s.OPENED||!this._sendFlag)throw new Error("Mock usage error detected.");this.body&&this._requestEndOfBody(),e="number"==typeof e?e:200;var n=void 0!==r?r:function(e){return u[e]||"Unknown Status"}(e);this._processResponse({status:e,statusMessage:n,headers:new o(t)})},s.prototype.downloadProgress=function(e,t){if(this._readyState!==s.HEADERS_RECEIVED&&this._readyState!==s.LOADING)throw new Error("Mock usage error detected.");this._readyState===s.HEADERS_RECEIVED&&(this._readyState=s.LOADING),this._fireReadyStateChange(),this._fireEvent("progress",e,t)},s.prototype.setResponseBody=function(e){if(void 0===e&&(e=null),!this._sendFlag||this._readyState!==s.OPENED&&this._readyState!==s.HEADERS_RECEIVED&&this._readyState!==s.LOADING)throw new Error("Mock usage error detected.");this._readyState===s.OPENED&&this.setResponseHeaders(),this._readyState=s.LOADING,this._fireReadyStateChange(),this._response.body=void 0!==e?e:null,this._handleResponseEndOfBody()},s.prototype.setNetworkError=function(){if(!this._sendFlag)throw new Error("Mock usage error detected.");this._processResponse(this._networkErrorResponse())},s.prototype.setRequestTimeout=function(){if(!this._sendFlag)throw new Error("Mock usage error detected.");this._terminateRequest(),this._timedOutFlag=!0,this._processResponse(this._networkErrorResponse())},s.prototype._requestEndOfBody=function(){if(this._uploadCompleteFlag=!0,this._uploadListenerFlag){var e=this._getRequestBodySize(),t=e;this._fireUploadEvent("progress",t,e),this._fireUploadEvent("load",t,e),this._fireUploadEvent("loadend",t,e)}},s.prototype._processResponse=function(e){this._response=e,this._handleResponseErrors(),this._isNetworkErrorResponse()||(this._readyState=s.HEADERS_RECEIVED,this._fireReadyStateChange(),this._readyState===s.HEADERS_RECEIVED&&null===this._response.body&&this._handleResponseEndOfBody())},s.prototype._handleResponseEndOfBody=function(){if(this._handleResponseErrors(),!this._isNetworkErrorResponse()){var e=this._response.body?this._response.body.length:0;this._fireEvent("progress",e,e),this._readyState=s.DONE,this._sendFlag=!1,this._fireReadyStateChange(),this._fireEvent("load",e,e),this._fireEvent("loadend",e,e)}},s.prototype._handleResponseErrors=function(){this._sendFlag&&(this._timedOutFlag?this._requestErrorSteps("timeout"):this._isNetworkErrorResponse()&&this._requestErrorSteps("error"))},s.prototype._requestErrorSteps=function(e){this._readyState=s.DONE,this._sendFlag=!1,this._response=this._networkErrorResponse(),this._fireReadyStateChange(),this._uploadCompleteFlag||(this._uploadCompleteFlag=!0,this._uploadListenerFlag&&(this._fireUploadEvent(e,0,0),this._fireUploadEvent("loadend",0,0))),this._fireEvent(e,0,0),this._fireEvent("loadend",0,0)},s.prototype._networkErrorResponse=function(){return{type:"error",status:0,statusMessage:"",headers:new o,body:null}},s.prototype._isNetworkErrorResponse=function(){return"error"===this._response.type},s.prototype._terminateRequest=function(){delete this.method,delete this.url},s.prototype._getRequestBodySize=function(){return this.body?this.body.size?this.body.size:this.body.length:0},s.prototype._newEvent=function(e,s,r){return new t(e,s,r)},s.prototype._fireEvent=function(e,t,s){this.dispatchEvent(this._newEvent(e,t,s))},s.prototype._fireUploadEvent=function(e,t,s){this._upload.dispatchEvent(this._newEvent(e,t,s))},s.prototype._fireReadyStateChange=function(){var e=new t("readystatechange");this.onreadystatechange&&this.onreadystatechange(e),this.dispatchEvent(e)},s.prototype._scheduleRequestTimeout=function(){var e=this;if(this._timeoutTask&&clearTimeout(this._timeoutTask),this._timeout>0){var t=Math.max(0,this._timeout-(Date.now()-this._timeoutReference));this._timeoutTask=setTimeout(function(){e._sendFlag&&e.setRequestTimeout(),delete e._timeoutTask},t)}},Object.defineProperties(s.prototype,r),s}(r);h.timeoutEnabled=!0,h.UNSENT=0,h.OPENED=1,h.HEADERS_RECEIVED=2,h.LOADING=3,h.DONE=4;var p=function(e,t){var s=this;void 0===t&&(t={}),this.MockXhr=e,this._requests=[],this._routes={},Object.keys(t).forEach(function(e){var r=t[e],o=r[0],n=r[1];s.addHandler(e,o,n)}),e.onSend=function(e){s._handleRequest(e)},this.xhrMock=e,this.xhrFactory=function(){return new s.MockXhr}};function l(){var e=function(e){function t(){e.call(this),"function"==typeof t.onCreate&&t.onCreate(this)}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.send=function(){for(var s=this,r=[],o=arguments.length;o--;)r[o]=arguments[o];if(e.prototype.send.apply(this,r),"function"==typeof t.onSend){var n=t.onSend;setTimeout(function(){return n.call(s,s)},0)}},t}(h);return e.timeoutEnabled=!0,e}p.prototype.install=function(e){return void 0===e&&(e=global),this._savedXMLHttpRequest=e.XMLHttpRequest,this._savedContext=e,e.XMLHttpRequest=this.MockXhr,this},p.prototype.remove=function(){if(!this._savedContext)throw new Error("remove() called without matching install(global).");void 0!==this._savedXMLHttpRequest?(this._savedContext.XMLHttpRequest=this._savedXMLHttpRequest,delete this._savedXMLHttpRequest):delete this._savedContext.XMLHttpRequest,delete this._savedContext},p.prototype.disableTimeout=function(){this.MockXhr.timeoutEnabled=!1},p.prototype.enableTimeout=function(){this.MockXhr.timeoutEnabled=!0},p.prototype.get=function(e,t){return this.addHandler("GET",e,t)},p.prototype.post=function(e,t){return this.addHandler("POST",e,t)},p.prototype.put=function(e,t){return this.addHandler("PUT",e,t)},p.prototype.delete=function(e,t){return this.addHandler("DELETE",e,t)},p.prototype.addHandler=function(e,t,s){return e=a(e),this._routes[e]||(this._routes[e]=[]),this._routes[e].push({matcher:t,handler:s,count:0}),this},p.prototype.setDefaultHandler=function(e){return this._defaultRoute={handler:e,count:0},this},p.prototype.setDefault404=function(){return this.setDefaultHandler({status:404})},p.prototype.getRequestLog=function(){return this._requests},p.prototype._handleRequest=function(e){this._requests.push({method:e.method,url:e.url,headers:e.requestHeaders.getHash(),body:e.body});var t=this._findFirstMatchingRoute(e)||this._defaultRoute;if(t){var s=t.handler;Array.isArray(s)&&(s=s[Math.min(s.length-1,t.count)]),t.count+=1,"function"==typeof s?s(e):e.respond(s.status,s.headers,s.body,s.statusText)}},p.prototype._findFirstMatchingRoute=function(e){var t=a(e.method);if(this._routes[t]){var s=e.url;return this._routes[t].find(function(e){var t=e.matcher;return"function"==typeof t?t(s):t instanceof RegExp?t.test(s):t===s})}},e.MockXhr=h,e.MockXhrServer=p,e.newMockXhr=l,e.newServer=function(e){return new p(l(),e)},Object.defineProperty(e,"__esModule",{value:!0})});